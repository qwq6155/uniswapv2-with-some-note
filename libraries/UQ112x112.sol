pragma solidity =0.5.16;

// 一个用于处理二进制定点数的库
// Q 格式 (Q number format)：https://en.wikipedia.org/wiki/Q_(number_format)
// UQ112x112 意思是一个 Unsigned (无符号) 的定点数，
// 整数部分占 112 位，小数部分占 112 位。总共 224 位。

// 范围: [0, 2**112 - 1] (整数部分最大值)
// 精度: 1 / 2**112 (能表示非常非常小的小数)

library UQ112x112 {
    
    // Q112 是一个常数，等于 2 的 112 次方。
    // 在二进制里，乘以 Q112 相当于把数字向左移动 112 位。
    // 这就把一个普通整数变成了定点数的“整数部分”。
    uint224 constant Q112 = 2**112;

    // --- 编码函数 (Encode) ---
    // 把一个 uint112 类型的普通整数，转换成 UQ112x112 格式。
    // 比如：输入 y = 1 (整数)
    // 输出 z = 1 * 2**112 (二进制看就是 1 后面跟着 112 个 0)
    // 这样，高 112 位是整数 1，低 112 位是小数 0。
    function encode(uint112 y) internal pure returns (uint224 z) {
        // 为什么不会溢出？
        // y 是 uint112，最大值 2**112 - 1。
        // z 是 uint224。
        // y * 2**112 正好把 y 移到了 z 的高 112 位，完全装得下。
        z = uint224(y) * Q112; 
    }

    // --- 除法函数 (UQDiv) ---
    // 这是一个特殊的除法：它用一个 UQ112x112 数 除以 一个普通 uint112 数。
    // 返回值仍然是一个 UQ112x112 数。
    // 公式： result = (x * 2**112) / y  (注意 x 已经是 encode 过的了，所以不需要再乘)
    // 实际上就是： z = x / y
    function uqdiv(uint224 x, uint112 y) internal pure returns (uint224 z) {
        // 直接做整数除法。
        // 因为 x 已经是定点数格式（带了 112 位的小数精度），
        // 所以 x / y 得到的结果，自然保留了高精度的小数部分。
        z = x / uint224(y);
    }
}
